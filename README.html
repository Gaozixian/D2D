<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>车辆监控系统 - 项目说明文档</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f8f9fa;
        }
        
        header {
            text-align: center;
            margin-bottom: 40px;
            padding: 20px;
            background-color: #0f172a;
            color: white;
            border-radius: 8px;
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        h2 {
            font-size: 1.8rem;
            margin: 30px 0 15px;
            color: #0f172a;
            border-bottom: 2px solid #e2e8f0;
            padding-bottom: 8px;
        }
        
        h3 {
            font-size: 1.4rem;
            margin: 20px 0 10px;
            color: #1e293b;
        }
        
        p {
            margin-bottom: 15px;
        }
        
        ul, ol {
            margin-bottom: 15px;
            padding-left: 25px;
        }
        
        li {
            margin-bottom: 8px;
        }
        
        code {
            background-color: #f1f5f9;
            padding: 2px 5px;
            border-radius: 4px;
            font-family: 'Courier New', Courier, monospace;
        }
        
        pre {
            background-color: #1e293b;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            margin-bottom: 20px;
        }
        
        pre code {
            background-color: transparent;
            color: inherit;
            padding: 0;
        }
        
        .note {
            background-color: #dbeafe;
            border-left: 4px solid #3b82f6;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }
        
        .warning {
            background-color: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }
        
        .tip {
            background-color: #dcfce7;
            border-left: 4px solid #10b981;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 0 8px 8px 0;
        }
        
        .section {
            background-color: white;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            margin-bottom: 30px;
        }
        
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .feature-item {
            background-color: #f8fafc;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .feature-item h4 {
            color: #0f172a;
            margin-bottom: 10px;
        }
        
        .architecture {
            display: flex;
            justify-content: space-between;
            margin: 30px 0;
        }
        
        .architecture-item {
            flex: 1;
            text-align: center;
            padding: 20px;
            margin: 0 10px;
            background-color: #f8fafc;
            border-radius: 8px;
            border: 1px solid #e2e8f0;
        }
        
        .architecture-item h4 {
            color: #0f172a;
            margin-bottom: 10px;
        }
        
        footer {
            text-align: center;
            margin-top: 50px;
            padding: 20px;
            color: #64748b;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .feature-list {
                grid-template-columns: 1fr;
            }
            
            .architecture {
                flex-direction: column;
            }
            
            .architecture-item {
                margin: 10px 0;
            }
        }
    </style>
</head>
<body>
    <header>
        <h1>车辆监控系统</h1>
        <p>基于Vue3和UniApp的实时车辆数据监控平台</p>
    </header>
    
    <div class="section">
        <h2>项目概述</h2>
        <p>车辆监控系统是一个基于Vue3和UniApp开发的实时车辆数据监控平台，用于连接Linux主机上的摄像头和传感器，实时显示车辆的速度、加速度和转向角等数据。系统支持多IP配置，可以同时监控多台车辆的数据。</p>
    </div>
    
    <div class="section">
        <h2>功能特点</h2>
        <div class="feature-list">
            <div class="feature-item">
                <h4>多IP配置</h4>
                <p>支持配置多个IP地址，可以同时监控多台车辆的数据。IP地址可以编辑和保存，方便管理。</p>
            </div>
            <div class="feature-item">
                <h4>实时摄像头画面</h4>
                <p>通过WebSocket或HTTP流技术，实时显示Linux主机上的摄像头画面，提供直观的视觉反馈。</p>
            </div>
            <div class="feature-item">
                <h4>实时数据监控</h4>
                <p>实时显示车辆的速度、加速度和转向角等数据，数据每秒更新一次，提供准确的车辆状态信息。</p>
            </div>
            <div class="feature-item">
                <h4>响应式设计</h4>
                <p>采用响应式设计，适配不同屏幕尺寸，在手机、平板和电脑上都能提供良好的用户体验。</p>
            </div>
            <div class="feature-item">
                <h4>开始/停止控制</h4>
                <p>提供开始/停止监控按钮，可以随时控制监控状态，节省资源。</p>
            </div>
            <div class="feature-item">
                <h4>错误处理和重连机制</h4>
                <p>内置错误处理和重连机制，当连接失败时会自动尝试重连，提高系统稳定性。</p>
            </div>
        </div>
    </div>
    
    <div class="section">
        <h2>技术架构</h2>
        <div class="architecture">
            <div class="architecture-item">
                <h4>前端</h4>
                <ul>
                    <li>Vue3 - 前端框架</li>
                    <li>UniApp - 跨平台开发框架</li>
                    <li>Pinia - 状态管理</li>
                    <li>SCSS - 样式预处理器</li>
                </ul>
            </div>
            <div class="architecture-item">
                <h4>后端</h4>
                <ul>
                    <li>Python - 后端语言</li>
                    <li>Flask - Web框架</li>
                    <li>OpenCV - 图像处理</li>
                    <li>NumPy - 数据处理</li>
                </ul>
            </div>
            <div class="architecture-item">
                <h4>通信</h4>
                <ul>
                    <li>HTTP/HTTPS - API通信</li>
                    <li>WebSocket - 实时数据流</li>
                    <li>MJPEG - 视频流</li>
                </ul>
            </div>
        </div>
    </div>
    
    <div class="section">
        <h2>安装说明</h2>
        
        <h3>前端安装</h3>
        <p>前端项目基于Vue3和UniApp开发，安装步骤如下：</p>
        <pre><code># 克隆项目
git clone [项目地址]

# 进入项目目录
cd my-vue3-project

# 安装依赖
npm install

# 运行开发服务器
npm run dev:h5</code></pre>
        
        <h3>后端安装（Linux主机）</h3>
        <p>后端需要在Linux主机上安装Python和相关库：</p>
        <pre><code># 安装Python和依赖
sudo apt update
sudo apt install python3 python3-pip python3-opencv

# 安装Python库
pip3 install flask numpy

# 创建并运行摄像头服务器
python3 camera_server.py</code></pre>
        
        <div class="note">
            <p><strong>注意：</strong> 确保Linux主机和前端设备在同一个网络中，并且防火墙允许8080端口的通信。</p>
        </div>
    </div>
    
    <div class="section">
        <h2>使用方法</h2>
        
        <h3>IP配置</h3>
        <ol>
            <li>打开应用，进入IP配置界面</li>
            <li>点击"编辑"按钮，输入Linux主机的IP地址</li>
            <li>点击确认保存IP地址</li>
        </ol>
        
        <h3>监控车辆</h3>
        <ol>
            <li>在IP配置界面，点击已配置的IP卡片</li>
            <li>系统会跳转到监控界面</li>
            <li>点击"开始监控"按钮开始接收数据</li>
            <li>系统会显示摄像头画面和实时数据</li>
            <li>点击"停止监控"按钮停止接收数据</li>
            <li>点击"返回"按钮返回IP配置界面</li>
        </ol>
        
        <div class="tip">
            <p><strong>提示：</strong> 如果连接失败，请检查Linux主机是否正常运行，以及网络连接是否正常。</p>
        </div>
    </div>
    
    <div class="section">
        <h2>Linux主机端代码</h2>
        <p>在Linux主机上需要运行以下Python代码（保存为camera_server.py）：</p>
        <pre><code>import cv2
import numpy as np
import time
import json
from flask import Flask, Response, jsonify
import threading

app = Flask(__name__)

# 全局变量
camera = None
is_running = False
current_data = {
    "speed": 0.0,
    "acceleration": 0.0,
    "steeringAngle": 0.0
}

# 初始化摄像头
def init_camera():
    global camera
    camera = cv2.VideoCapture(0)  # 使用默认摄像头，如果有多个摄像头可以修改索引
    if not camera.isOpened():
        print("无法打开摄像头")
        return False
    return True

# 生成视频流
def generate_frames():
    global camera, is_running
    while is_running:
        success, frame = camera.read()
        if not success:
            break
        else:
            # 将图像编码为JPEG格式
            ret, buffer = cv2.imencode('.jpg', frame)
            frame = buffer.tobytes()
            yield (b'--frame\r\n'
                   b'Content-Type: image/jpeg\r\n\r\n' + frame + b'\r\n')
        time.sleep(0.033)  # 约30fps

# 模拟数据采集
def collect_data():
    global is_running, current_data
    while is_running:
        # 这里替换为实际的数据采集逻辑
        # 例如从传感器读取数据
        current_data["speed"] = np.random.uniform(0, 60)
        current_data["acceleration"] = np.random.uniform(-2, 2)
        current_data["steeringAngle"] = np.random.uniform(-45, 45)
        time.sleep(0.1)  # 10Hz更新率

# 启动数据采集
def start_data_collection():
    global is_running
    is_running = True
    threading.Thread(target=collect_data).start()

# 停止数据采集
def stop_data_collection():
    global is_running
    is_running = False

# 路由：视频流
@app.route('/stream')
def video_feed():
    return Response(generate_frames(),
                    mimetype='multipart/x-mixed-replace; boundary=frame')

# 路由：传感器数据
@app.route('/data')
def get_data():
    return jsonify(current_data)

# 路由：开始监控
@app.route('/start', methods=['POST'])
def start_monitoring():
    if not is_running:
        start_data_collection()
        return jsonify({"status": "success", "message": "监控已开始"})
    return jsonify({"status": "error", "message": "监控已在运行"})

# 路由：停止监控
@app.route('/stop', methods=['POST'])
def stop_monitoring():
    if is_running:
        stop_data_collection()
        return jsonify({"status": "success", "message": "监控已停止"})
    return jsonify({"status": "error", "message": "监控未在运行"})

if __name__ == '__main__':
    if init_camera():
        app.run(host='0.0.0.0', port=8080, threaded=True)
    else:
        print("摄像头初始化失败，服务器无法启动")</code></pre>
        
        <div class="warning">
            <p><strong>注意：</strong> 在实际应用中，应该替换模拟数据为真实的传感器数据。</p>
        </div>
    </div>
    
    <div class="section">
        <h2>常见问题</h2>
        
        <h3>无法连接到Linux主机</h3>
        <p>可能的原因：</p>
        <ul>
            <li>Linux主机未运行摄像头服务器</li>
            <li>IP地址配置错误</li>
            <li>防火墙阻止了8080端口</li>
            <li>Linux主机和前端设备不在同一个网络中</li>
        </ul>
        <p>解决方法：</p>
        <ul>
            <li>确保Linux主机已运行摄像头服务器</li>
            <li>检查IP地址是否正确</li>
            <li>在Linux主机上运行 <code>sudo ufw allow 8080</code> 允许8080端口</li>
            <li>确保Linux主机和前端设备在同一个网络中</li>
        </ul>
        
        <h3>摄像头画面不显示</h3>
        <p>可能的原因：</p>
        <ul>
            <li>摄像头未正确连接</li>
            <li>摄像头驱动未安装</li>
            <li>摄像头被其他程序占用</li>
        </ul>
        <p>解决方法：</p>
        <ul>
            <li>检查摄像头连接</li>
            <li>安装摄像头驱动：<code>sudo apt install python3-opencv</code></li>
            <li>关闭其他可能占用摄像头的程序</li>
        </ul>
    </div>
    
    <div class="section">
        <h2>补充：</h2>
        <ul>
            <li>暂无</li>
        </ul>
    </div>
    
    <footer>
        <p>© 2024 车辆监控系统 | 基于Vue3和UniApp开发</p>
    </footer>
</body>
</html> 